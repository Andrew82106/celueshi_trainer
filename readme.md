# 山门知行训练应用

## 项目概述

山门知行是一款专注于认知能力和语言能力训练的微信小程序，旨在帮助用户通过系统性训练提升注意力、记忆力、语言表达和思维逻辑等多方面能力。应用提供多种科学训练方案，记录训练历史，追踪能力提升过程。

## 主要功能模块

### 中英互翻训练
- **双向翻译模式**：支持英译中和中译英两种训练方向
- **智能评测**：接入GLM大模型API，提供专业翻译评分和改进建议
- **详细分析**：对每个翻译片段给予0-10分的精确评分，并提供具体改进建议
- **历史记录**：保存训练结果，方便复习和对比进步

### 舒尔特表训练
- **可调整难度**：支持3×3至10×10的表格尺寸
- **实时反馈**：训练过程中显示用时和错误数
- **完整记录**：记录每次训练的表格大小、完成时间和错误次数
- **专注力培养**：经典的注意力分配和视觉扫描能力训练工具

### 圆点闪视训练
- **自定义参数**：可设置圆点数量范围(2-20)和闪现时间(毫秒级精确控制)
- **随机生成**：每次训练随机生成不同数量和位置的圆点
- **快速感知训练**：锻炼视觉快速捕捉和数量感知能力
- **训练记录**：保存每次训练的参数设置和正确率

### 正听反说训练
- **听觉记忆训练**：系统播放随机数字音频，用户需逆序输入
- **可调节难度**：支持5-20位数字长度
- **音频播放**：清晰的数字音频提示，无需依赖视觉
- **即时反馈**：训练完成后立即给出正确答案和评估
- **成绩记录**：保存每次训练的数字长度和正确情况

### 山门训练

见山门训练版块介绍

## 技术架构

### 前端技术
- **框架**：微信小程序原生开发框架
- **UI组件**：自定义导航栏、进度条、卡片视图等组件
- **交互设计**：流畅的动画过渡和反馈机制
- **适配性**：适配不同尺寸的移动设备

### 后端接口
- **智能评测**：接入智谱GLM-4大模型API进行翻译质量评估
- **数据处理**：JSON格式数据交互，支持复杂评测结果解析

### 存储机制
- **本地存储**：利用微信小程序的本地存储功能存储用户训练记录
- **数据分类**：按训练类型分别存储（translateRecords、schulteRecords等）
- **用户绑定**：训练记录与微信用户身份绑定，确保数据安全

### 用户体验优化
- **一致性设计**：统一的色彩系统和交互模式
- **渐进式引导**：由简到难的训练流程设计
- **成就激励**：通过历史记录和进步统计激励持续训练
- **即时反馈**：训练过程中的实时反馈和结果展示

## 项目特色

1. **科学性**：基于认知科学设计的训练方法，有效提升专注力和记忆力
2. **全面性**：涵盖视觉、听觉、语言等多维度能力训练
3. **个性化**：可根据个人能力调整训练难度和参数
4. **数据驱动**：详细的训练记录帮助用户了解自己的能力提升轨迹
5. **无障碍使用**：简洁直观的界面设计，适合各年龄段用户

## 开发环境

- 微信开发者工具 v3.7.8及以上
- 小程序基础库 v3.7.8及以上
- Node.js环境（用于开发和调试）

## 项目结构

```
/pages
  /index                 # 首页
  /main                  # 登录页
  /profile               # 个人中心
  /schulte-table         # 舒尔特表训练
  /schulte-records       # 舒尔特表记录
  /dot-training          # 圆点闪视训练
  /dot-records           # 圆点闪视记录
  /audio-training        # 正听反说训练
  /audio-records         # 正听反说记录
  /translate-training    # 翻译训练主页
  /translate-drill       # 翻译训练过程
  /translate-review      # 翻译评测
  /translate-records     # 翻译训练记录
```

## 分包加载策略

为优化小程序的加载速度和减小包体积，本项目采用了微信小程序的分包加载功能。分包策略如下：

### 分包结构

```
/主包                    # 包含首页和基础功能
/packageTrain            # 训练功能分包
/packageRecords          # 训练记录功能分包
/packageZen              # 禅修功能分包
/packageZenAssets        # 禅修资源分包(音频、图片)
/packageTrainAssets      # 训练资源分包(音频、图片)
/packageRecordsAssets    # 记录资源分包(图片)
```

### 分包规则说明

1. **主包**：仅包含启动页和核心功能，减少首次加载时间
2. **功能分包**：按照功能模块划分，各模块的页面和逻辑代码
3. **资源分包**：将音频、图片等大型资源文件单独分包存储
   - packageZenAssets: 存放木鱼、颂钵音效等禅修相关资源
   - packageTrainAssets: 存放训练相关音频和图像资源
   - packageRecordsAssets: 存放记录页面使用的图像资源

### 资源分包实现方法

我们使用了自动化脚本(subpackage_assets_script.sh)来优化资源分包：

```bash
# 关键步骤
1. 创建资源分包目录结构
2. 移动(而非复制)资源文件到对应分包目录
3. 更新代码中的资源引用路径
```

### 分包注意事项

1. 避免资源重复：确保每个资源文件只存在于一个分包中，避免重复增加总体积
2. 路径引用正确：修改代码中的资源引用路径，使其指向正确的分包路径
3. 分包预加载：根据页面跳转逻辑，在app.json中配置preloadRule实现分包预加载

### 分包优化效果

通过分包加载策略，实现了以下优化：
- 减小主包体积至约500KB，提高首次启动速度
- 将大型资源文件（如音频）从主包移至分包，避免重复加载
- 按需加载功能和资源，提高整体小程序性能

## 使用说明

1. 首次使用需进行微信登录授权
2. 在首页选择需要训练的能力模块
3. 设置训练参数（如难度等级）
4. 完成训练后查看结果评分和建议
5. 在个人中心查看历史训练记录和成绩统计

## 未来计划

- 增加更多训练模块（如工作记忆训练、逻辑推理训练等）
- 添加社交功能，支持好友间的训练比拼
- **开发数据分析功能，提供更详细的能力评估报告**
- 优化UI/UX设计，提升用户体验

---

# 山门训练

山门训练用于进行内省和专注力训练，集成了木鱼、颂钵功能以及内观写作打卡功能

## 木鱼颂钵功能

用户可以通过页面下方的导航栏进入木鱼颂钵页面，页面提供木鱼和颂钵敲击、木鱼颂钵音频播放和计时功能，用户可以选择木鱼和颂钵进行训练，并记录训练次数和时间。

页面中还包含背景替换功能，用户可以点击右下角按钮来更换背景。

## 内观写作功能

内观写作页面用于给用户提供内观后的感想记录功能。

该页面给用户提供如下接口：

- 字数输入：用户可以输入写作的字数，用于记录
- 感想输入：用户可以向文本框里输入内观写作后的感想文本
- 提交按钮：用户点击提交按钮，将输入的字数和感想提交到后端数据库，并返回提交结果

除了上述接口之外，页面还提供感想列表功能，用户可以查看自己之前输入的感想。

同时页面还提供其他用户的感想浏览功能，用户可以查看其他用户的感想。

# 后端数据库结构

后端数据库包含两个数据表：trainlog和userinfo表。本项目的数据首先需要备份到云端，之后才在本地进行备份。当发生冲突时以云端为准。

需要注意，微信云后端数据库中每次查询数据量最多20条，因此需要编写分页查询的逻辑。

## trainlog表

保存用户训练数据，每一条数据包含如下字段：

- "_id": 代表数据库中的ID
- "_openid": 代表用户的openId
- "date": 代表训练日期，格式为XXXX-XX-XX
- "openId": 代表用户的openId
- "muyuCounts": 代表用户木鱼次数
- "songboCounts": 代表用户颂钵次数
- "muyuSeconds": 代表用户木鱼时间
- "songboSeconds": 代表用户颂钵时间

这里的muyuCounts、songboCounts、muyuSeconds、songboSeconds，不一定会都有存在，有的用户只敲木鱼或者只敲颂钵。


## userinfo表

保存用户信息数据，每一条数据包含如下字段：

- "_id": 代表数据库中的ID
- "openId": 代表用户的openId
- "nickName": 代表用户的昵称
- "avatarUrl": 代表用户的头像
- "level": 代表用户的段位
- "accumulateMuyu": 代表用户累计木鱼次数
- "accumulateMuyuTime": 代表用户累计木鱼时间
- "accumulateSongbo": 代表用户累计颂钵次数
- "accumulateSongboTime": 代表用户累计颂钵时间
- "lastUpdateTime": 用于数据库索引加速，代表最后更新accumulateMuyu、accumulateMuyuTime、accumulateSongbo、accumulateSongboTime的时间戳
- "accumulateCount": 代表用户感想总字符数量

上述字段中，accumulateMuyu、accumulateMuyuTime、accumulateSongbo、accumulateSongboTime、lastUpdateTime统称加速字段，因为其作用在于快速查询用户数据，而不需要每次都去数据库中查询。

## writelog表

保存用户内观写作感想的训练数据，每一条数据包含如下字段：
- "_id": 代表数据库中的ID
- "openId": 代表用户的openId
- "date": 代表训练日期，格式为XXXX-XX-XX，同一天可以有多次训练数据
- "content": 代表用户输入的感想文本（没有就填入空）
- "count": 代表用户输入的感想文本的字符数量
- "like": 代表用户输入的感想文本的点赞数量
- "visible": 代表用户输入的感想文本的可见性，默认为true，用户可以修改为false来隐藏感想文本"


# tips

## 微信开发规范

- 页面跳转使用wx.redirectTo方法一定有用，其他的不一定

© 知行训练 - 专注于认知能力训练的微信小程序
